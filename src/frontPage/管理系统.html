<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学生成绩管理系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        nav {
            background-color: #34495e;
            margin-bottom: 20px;
        }

        .nav-tabs {
            display: flex;
            list-style: none;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .nav-tab {
            padding: 15px 25px;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .nav-tab:hover {
            background-color: #3d566e;
        }

        .nav-tab.active {
            background-color: #3498db;
            font-weight: bold;
        }

        .content-section {
            display: none;
            background-color: white;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .content-section.active {
            display: block !important;
        }

        .section-title {
            font-size: 22px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            color: #2c3e50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f8f9fa;
            font-weight: bold;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
            margin-right: 5px;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-success {
            background-color: #2ecc71;
            color: white;
        }

        .btn-success:hover {
            background-color: #27ae60;
        }

        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-warning {
            background-color: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background-color: #d35400;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-bar input {
            flex: 1;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 5px;
            width: 80%;
            max-width: 500px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .message {
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .message.success {
            background-color: #d4edda;
            color: #155724;
        }

        .message.error {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <!-- 头部 -->
    <header>
        <div class="header-content">
            <div class="logo">学生成绩管理系统</div>
            <div class="user-info">
                <span id="userName">未登录</span>
                <button class="btn btn-primary" onclick="logout()">退出</button>
            </div>
        </div>
    </header>

    <!-- 导航 - 根据角色动态显示 -->
    <nav>
        <ul class="nav-tabs" id="navTabs">
            <!-- 导航项将根据角色动态生成 -->
        </ul>
    </nav>

    <!-- 主要内容区域 -->
    <div class="container">
        <div id="messageArea"></div>

        <!-- ========== 管理员界面 ========== -->
        
        <!-- 用户管理 -->
        <section id="user-management" class="content-section" style="display:none;">
            <h2 class="section-title">
                <span>用户管理</span>
            </h2>
            <div class="search-bar">
                <input type="text" id="userSearch" placeholder="搜索用户名...">
                <button class="btn btn-primary" onclick="searchUsers()">搜索</button>
                <button class="btn btn-primary" onclick="loadUsers()">刷新</button>
            </div>
            <table id="userTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>用户名</th>
                        <th>角色</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="userTableBody"></tbody>
            </table>
        </section>

        <!-- 学生信息管理（管理员） -->
        <section id="student-management" class="content-section" style="display:none;">
            <h2 class="section-title">
                <span>学生信息管理</span>
                <button class="btn btn-success" onclick="showAddStudentModal()">添加学生</button>
            </h2>

            <div class="search-bar">
                <input type="text" id="studentSearch" placeholder="搜索学生姓名或学号...">
                <button class="btn btn-primary" onclick="searchStudents()">搜索</button>
                <button class="btn btn-primary" onclick="loadStudents()">刷新</button>
            </div>

            <table id="studentTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>学号</th>
                        <th>姓名</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="studentTableBody">
                </tbody>
            </table>
        </section>

        <!-- 教师信息管理 -->
        <section id="teacher-management" class="content-section">
            <h2 class="section-title">
                <span>教师信息管理</span>
                <button class="btn btn-success" onclick="showAddTeacherModal()">添加教师</button>
            </h2>

            <div class="search-bar">
                <input type="text" id="teacherSearch" placeholder="搜索教师姓名或工号...">
                <button class="btn btn-primary" onclick="searchTeachers()">搜索</button>
                <button class="btn btn-primary" onclick="loadTeachers()">刷新</button>
            </div>

            <table id="teacherTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>工号</th>
                        <th>姓名</th>
                        <th>用户ID</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="teacherTableBody">
                </tbody>
            </table>
        </section>

        <!-- 课程管理 -->
        <section id="course-management" class="content-section">
            <h2 class="section-title">
                <span>课程管理</span>
                <button class="btn btn-success" onclick="showAddCourseModal()">添加课程</button>
            </h2>

            <div class="search-bar">
                <button class="btn btn-primary" onclick="loadCourses()">刷新</button>
            </div>

            <table id="courseTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>课程名称</th>
                        <th>学分</th>
                        <th>教师ID</th>
                        <th>用户ID</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="courseTableBody">
                </tbody>
            </table>
        </section>

        <!-- 成绩管理 -->
        <section id="score-management" class="content-section">
            <h2 class="section-title">
                <span>成绩管理</span>
            </h2>

            <div class="search-bar">
                <select id="scoreCourseSelect">
                    <option value="">选择课程</option>
                </select>
                <button class="btn btn-primary" onclick="loadCourseStudents()">查看学生名单</button>
                <button class="btn btn-success" onclick="showBatchImportModal()">批量导入</button>
            </div>

            <table id="scoreTable">
                <thead>
                    <tr>
                        <th>学生ID</th>
                        <th>课程ID</th>
                        <th>成绩</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="scoreTableBody">
                </tbody>
            </table>
        </section>

        <!-- 成绩统计 -->
        <section id="statistics" class="content-section">
            <h2 class="section-title">
                <span>成绩统计</span>
            </h2>

            <div class="search-bar">
                <select id="statCourseSelect">
                    <option value="">选择课程</option>
                </select>
                <input type="number" id="statStudentId" placeholder="学生ID（可选）">
                <button class="btn btn-primary" onclick="loadStatistics()">查询统计</button>
            </div>

            <div id="statisticsResult"></div>
        </section>
    </div>

    <!-- 添加学生模态框 -->
    <div id="addStudentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addStudentModal')">&times;</span>
            <h2>添加学生</h2>
            <form id="addStudentForm">
                <div class="form-group">
                    <label>学号:</label>
                    <input type="text" name="studentNumber" required>
                </div>
                <div class="form-group">
                    <label>姓名:</label>
                    <input type="text" name="name" required>
                </div>
                <button type="submit" class="btn btn-success">提交</button>
            </form>
        </div>
    </div>

    <!-- 添加教师模态框 -->
    <div id="addTeacherModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addTeacherModal')">&times;</span>
            <h2>添加教师</h2>
            <form id="addTeacherForm">
                <div class="form-group">
                    <label>工号:</label>
                    <input type="text" name="teacherNumber" required>
                </div>
                <div class="form-group">
                    <label>姓名:</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>用户ID:</label>
                    <input type="number" name="userId" required>
                </div>
                <button type="submit" class="btn btn-success">提交</button>
            </form>
        </div>
    </div>

    <!-- 添加课程模态框 -->
    <div id="addCourseModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addCourseModal')">&times;</span>
            <h2>添加课程</h2>
            <form id="addCourseForm">
                <div class="form-group">
                    <label>课程名称:</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>学分:</label>
                    <input type="number" step="0.1" name="credit" required>
                </div>
                <div class="form-group">
                    <label>教师ID:</label>
                    <input type="number" name="teacherId" required>
                </div>
                <div class="form-group">
                    <label>用户ID:</label>
                    <input type="number" name="userId" required>
                </div>
                <button type="submit" class="btn btn-success">提交</button>
            </form>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8089';

        // 导航切换
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                this.classList.add('active');
                document.getElementById(this.getAttribute('data-target')).classList.add('active');
            });
        });

        // 显示消息
        function showMessage(message, type = 'success') {
            const messageArea = document.getElementById('messageArea');
            messageArea.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => {
                messageArea.innerHTML = '';
            }, 3000);
        }

        // 模态框操作
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // 加载学生列表
        async function loadStudents() {
            try {
                const response = await fetch(`${API_BASE}/student/getAll`);
                const students = await response.json();
                const tbody = document.getElementById('studentTableBody');
                tbody.innerHTML = students.map(s => `
                    <tr>
                        <td>${s.id}</td>
                        <td>${s.studentNumber || ''}</td>
                        <td>${s.name || ''}</td>
                        <td>
                            <button class="btn btn-primary" onclick="editStudent(${s.id})">编辑</button>
                            <button class="btn btn-danger" onclick="deleteStudent(${s.id})">删除</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                showMessage('加载学生列表失败: ' + error.message, 'error');
            }
        }

        // 搜索学生
        async function searchStudents() {
            const name = document.getElementById('studentSearch').value;
            if (!name) {
                loadStudents();
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/student/search?name=${encodeURIComponent(name)}`);
                const students = await response.json();
                const tbody = document.getElementById('studentTableBody');
                tbody.innerHTML = students.map(s => `
                    <tr>
                        <td>${s.id}</td>
                        <td>${s.studentNumber || ''}</td>
                        <td>${s.name || ''}</td>
                        <td>
                            <button class="btn btn-primary" onclick="editStudent(${s.id})">编辑</button>
                            <button class="btn btn-danger" onclick="deleteStudent(${s.id})">删除</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                showMessage('搜索失败: ' + error.message, 'error');
            }
        }

        // 添加学生
        function showAddStudentModal() {
            showModal('addStudentModal');
        }

        document.getElementById('addStudentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const student = {
                studentNumber: formData.get('studentNumber'),
                name: formData.get('name')
            };
            try {
                const response = await fetch(`${API_BASE}/student/add`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(student)
                });
                const result = await response.text();
                showMessage(result);
                closeModal('addStudentModal');
                this.reset();
                loadStudents();
            } catch (error) {
                showMessage('添加失败: ' + error.message, 'error');
            }
        });

        // 删除学生
        async function deleteStudent(id) {
            if (!confirm('确定要删除这个学生吗？')) return;
            try {
                const response = await fetch(`${API_BASE}/student/delete/${id}`, {method: 'DELETE'});
                const result = await response.text();
                showMessage(result);
                loadStudents();
            } catch (error) {
                showMessage('删除失败: ' + error.message, 'error');
            }
        }

        // 加载教师列表
        async function loadTeachers() {
            try {
                const response = await fetch(`${API_BASE}/teacher/getAll`);
                const teachers = await response.json();
                const tbody = document.getElementById('teacherTableBody');
                tbody.innerHTML = teachers.map(t => `
                    <tr>
                        <td>${t.id}</td>
                        <td>${t.teacherNumber || ''}</td>
                        <td>${t.name || ''}</td>
                        <td>${t.userId || ''}</td>
                        <td>
                            <button class="btn btn-primary" onclick="editTeacher(${t.id})">编辑</button>
                            <button class="btn btn-danger" onclick="deleteTeacher(${t.id})">删除</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                showMessage('加载教师列表失败: ' + error.message, 'error');
            }
        }

        // 搜索教师
        async function searchTeachers() {
            const name = document.getElementById('teacherSearch').value;
            if (!name) {
                loadTeachers();
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/teacher/search?name=${encodeURIComponent(name)}`);
                const teachers = await response.json();
                const tbody = document.getElementById('teacherTableBody');
                tbody.innerHTML = teachers.map(t => `
                    <tr>
                        <td>${t.id}</td>
                        <td>${t.teacherNumber || ''}</td>
                        <td>${t.name || ''}</td>
                        <td>${t.userId || ''}</td>
                        <td>
                            <button class="btn btn-primary" onclick="editTeacher(${t.id})">编辑</button>
                            <button class="btn btn-danger" onclick="deleteTeacher(${t.id})">删除</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                showMessage('搜索失败: ' + error.message, 'error');
            }
        }

        // 添加教师
        function showAddTeacherModal() {
            showModal('addTeacherModal');
        }

        document.getElementById('addTeacherForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const teacher = {
                teacherNumber: formData.get('teacherNumber'),
                name: formData.get('name'),
                userId: parseInt(formData.get('userId'))
            };
            try {
                const response = await fetch(`${API_BASE}/teacher/add`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(teacher)
                });
                const result = await response.text();
                showMessage(result);
                closeModal('addTeacherModal');
                this.reset();
                loadTeachers();
            } catch (error) {
                showMessage('添加失败: ' + error.message, 'error');
            }
        });

        // 删除教师
        async function deleteTeacher(id) {
            if (!confirm('确定要删除这个教师吗？')) return;
            try {
                const response = await fetch(`${API_BASE}/teacher/delete/${id}`, {method: 'DELETE'});
                const result = await response.text();
                showMessage(result);
                loadTeachers();
            } catch (error) {
                showMessage('删除失败: ' + error.message, 'error');
            }
        }

        // 加载课程列表
        async function loadCourses() {
            try {
                const response = await fetch(`${API_BASE}/courseManagement/getAllCourse`);
                const courses = await response.json();
                const tbody = document.getElementById('courseTableBody');
                tbody.innerHTML = courses.map(c => `
                    <tr>
                        <td>${c.id}</td>
                        <td>${c.name || ''}</td>
                        <td>${c.credit || ''}</td>
                        <td>${c.teacherId || ''}</td>
                        <td>${c.userId || ''}</td>
                        <td>
                            <button class="btn btn-primary" onclick="editCourse(${c.id})">编辑</button>
                            <button class="btn btn-danger" onclick="deleteCourse('${c.name}')">删除</button>
                        </td>
                    </tr>
                `).join('');
                
                // 更新课程选择下拉框
                const courseSelect = document.getElementById('scoreCourseSelect');
                const statCourseSelect = document.getElementById('statCourseSelect');
                const options = '<option value="">选择课程</option>' + 
                    courses.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
                courseSelect.innerHTML = options;
                statCourseSelect.innerHTML = options;
            } catch (error) {
                showMessage('加载课程列表失败: ' + error.message, 'error');
            }
        }

        // 添加课程
        function showAddCourseModal() {
            showModal('addCourseModal');
        }

        document.getElementById('addCourseForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const course = {
                name: formData.get('name'),
                credit: parseFloat(formData.get('credit')),
                teacherId: parseInt(formData.get('teacherId')),
                userId: parseInt(formData.get('userId'))
            };
            try {
                const response = await fetch(`${API_BASE}/courseManagement/addCourse`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(course)
                });
                const result = await response.text();
                showMessage(result);
                closeModal('addCourseModal');
                this.reset();
                loadCourses();
            } catch (error) {
                showMessage('添加失败: ' + error.message, 'error');
            }
        });

        // 删除课程
        async function deleteCourse(name) {
            if (!confirm('确定要删除这个课程吗？')) return;
            try {
                const response = await fetch(`${API_BASE}/courseManagement/deleteCourse/${encodeURIComponent(name)}`, {method: 'DELETE'});
                const result = await response.text();
                showMessage(result);
                loadCourses();
            } catch (error) {
                showMessage('删除失败: ' + error.message, 'error');
            }
        }

        // 加载课程学生名单
        async function loadCourseStudents() {
            const courseId = document.getElementById('scoreCourseSelect').value;
            if (!courseId) {
                showMessage('请先选择课程', 'error');
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/courseSelect/getCourseStudents/${courseId}`);
                const selections = await response.json();
                const tbody = document.getElementById('scoreTableBody');
                tbody.innerHTML = selections.map(s => `
                    <tr>
                        <td>${s.studentId}</td>
                        <td>${s.courseId}</td>
                        <td>${s.score >= 0 ? s.score : '未录入'}</td>
                        <td>
                            <input type="number" id="score_${s.studentId}_${s.courseId}" value="${s.score >= 0 ? s.score : ''}" min="0" max="100" style="width:80px;">
                            <button class="btn btn-primary" onclick="updateScore(${s.studentId}, ${s.courseId})">保存</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                showMessage('加载学生名单失败: ' + error.message, 'error');
            }
        }

        // 更新成绩
        async function updateScore(studentId, courseId) {
            const scoreInput = document.getElementById(`score_${studentId}_${courseId}`);
            const score = parseInt(scoreInput.value);
            if (isNaN(score) || score < 0 || score > 100) {
                showMessage('成绩必须在0-100之间', 'error');
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/scoreManagement/addScore?StudentId=${studentId}&CourseId=${courseId}&score=${score}`, {
                    method: 'POST'
                });
                const result = await response.text();
                showMessage(result);
                loadCourseStudents();
            } catch (error) {
                showMessage('更新失败: ' + error.message, 'error');
            }
        }

        // 批量导入成绩
        function showBatchImportModal() {
            const courseId = document.getElementById('scoreCourseSelect').value;
            if (!courseId) {
                showMessage('请先选择课程', 'error');
                return;
            }
            const scoresText = prompt('请输入成绩数据（JSON格式）:\n[{"studentId": 1, "score": 85}, ...]');
            if (!scoresText) return;
            try {
                const scores = JSON.parse(scoresText);
                batchImportScores(courseId, scores);
            } catch (error) {
                showMessage('JSON格式错误: ' + error.message, 'error');
            }
        }

        async function batchImportScores(courseId, scores) {
            try {
                const response = await fetch(`${API_BASE}/scoreManagement/batchImport?courseId=${courseId}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(scores)
                });
                const result = await response.text();
                showMessage(result);
                loadCourseStudents();
            } catch (error) {
                showMessage('批量导入失败: ' + error.message, 'error');
            }
        }

        // 加载统计信息
        async function loadStatistics() {
            const courseId = document.getElementById('statCourseSelect').value;
            const studentId = document.getElementById('statStudentId').value;
            const resultDiv = document.getElementById('statisticsResult');
            
            if (courseId) {
                try {
                    const response = await fetch(`${API_BASE}/statisticsMessage/courseStatistics?courseId=${courseId}`);
                    const stats = await response.json();
                    resultDiv.innerHTML = `
                        <h3>课程统计信息</h3>
                        <p>平均分: ${stats.average !== null ? stats.average.toFixed(2) : '无'}</p>
                        <p>最高分: ${stats.max !== null ? stats.max : '无'}</p>
                        <p>最低分: ${stats.min !== null ? stats.min : '无'}</p>
                        <p>总人数: ${stats.count}</p>
                    `;
                } catch (error) {
                    showMessage('加载统计失败: ' + error.message, 'error');
                }
            } else if (studentId) {
                try {
                    const response = await fetch(`${API_BASE}/statisticsMessage/studentStatistics?studentId=${studentId}`);
                    const stats = await response.json();
                    resultDiv.innerHTML = `
                        <h3>学生统计信息</h3>
                        <p>平均分: ${stats.average !== null ? stats.average.toFixed(2) : '无'}</p>
                        <p>最高分: ${stats.max !== null ? stats.max : '无'}</p>
                        <p>最低分: ${stats.min !== null ? stats.min : '无'}</p>
                        <p>课程数: ${stats.count}</p>
                    `;
                } catch (error) {
                    showMessage('加载统计失败: ' + error.message, 'error');
                }
            } else {
                showMessage('请选择课程或输入学生ID', 'error');
            }
        }

        // 检查登录状态并初始化角色界面
        function checkLoginStatus() {
            const isLoggedIn = sessionStorage.getItem('isLoggedIn');
            const username = sessionStorage.getItem('username');
            const userRole = sessionStorage.getItem('userRole') || 'student';
            const userId = sessionStorage.getItem('userId');
            
            if (!isLoggedIn || isLoggedIn !== 'true') {
                // 未登录，跳转到登录页面
                alert('请先登录');
                window.location.href = '登陆界面.html';
                return false;
            }
            
            // 已登录，显示用户名和角色
            const userNameElement = document.getElementById('userName');
            if (userNameElement) {
                const roleText = userRole === 'admin' ? '管理员' : 
                               userRole === 'teacher' ? '教师' : '学生';
                userNameElement.textContent = `欢迎，${username || '用户'} (${roleText})`;
            }
            
            // 根据角色初始化界面
            initRoleBasedUI(userRole, userId);
            
            return true;
        }

        // 根据角色初始化界面
        function initRoleBasedUI(role, userId) {
            const navTabs = document.getElementById('navTabs');
            navTabs.innerHTML = '';
            
            if (role === 'admin') {
                // 管理员界面
                initAdminUI();
            } else if (role === 'teacher') {
                // 教师界面
                initTeacherUI(userId);
            } else {
                // 学生界面
                initStudentUI(userId);
            }
        }

        // 初始化管理员界面
        function initAdminUI() {
            const navTabs = document.getElementById('navTabs');
            navTabs.innerHTML = `
                <li class="nav-tab active" data-target="user-management">用户管理</li>
                <li class="nav-tab" data-target="student-management">学生信息管理</li>
                <li class="nav-tab" data-target="teacher-management">教师信息管理</li>
                <li class="nav-tab" data-target="course-management">课程管理</li>
                <li class="nav-tab" data-target="statistics">系统统计</li>
            `;
            
            // 显示管理员内容区域
            showAdminSections();
            
            // 绑定导航事件
            bindNavEvents();
        }

        // 初始化教师界面
        function initTeacherUI(userId) {
            const navTabs = document.getElementById('navTabs');
            navTabs.innerHTML = `
                <li class="nav-tab active" data-target="teacher-score-management">成绩管理</li>
                <li class="nav-tab" data-target="teacher-statistics">成绩统计</li>
                <li class="nav-tab" data-target="teacher-courses">我的课程</li>
            `;
            
            // 显示教师内容区域
            showTeacherSections();
            
            // 绑定导航事件
            bindNavEvents();
            
            // 加载教师相关数据
            loadTeacherCourses(userId);
        }

        // 初始化学生界面
        function initStudentUI(userId) {
            const navTabs = document.getElementById('navTabs');
            navTabs.innerHTML = `
                <li class="nav-tab active" data-target="student-info">个人信息</li>
                <li class="nav-tab" data-target="student-courses">我的选课</li>
                <li class="nav-tab" data-target="student-scores">我的成绩</li>
                <li class="nav-tab" data-target="course-selection">选课中心</li>
            `;
            
            // 显示学生内容区域
            showStudentSections();
            
            // 绑定导航事件
            bindNavEvents();
            
            // 加载学生相关数据
            loadStudentInfo(userId);
            loadStudentCourses(userId);
            loadStudentScores(userId);
            loadAvailableCourses();
        }

        // 绑定导航事件
        function bindNavEvents() {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.content-section').forEach(s => {
                        s.classList.remove('active');
                        s.style.display = 'none';
                    });
                    this.classList.add('active');
                    const targetId = this.getAttribute('data-target');
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.style.display = 'block';
                        targetSection.classList.add('active');
                        
                        // 根据切换的标签页加载相应数据
                        const userRole = sessionStorage.getItem('userRole');
                        const userId = sessionStorage.getItem('userId');
                        
                        if (targetId === 'teacher-courses' && userRole === 'teacher') {
                            loadTeacherCourses(userId);
                        } else if (targetId === 'student-courses' && userRole === 'student') {
                            loadStudentCourses(userId);
                        } else if (targetId === 'student-scores' && userRole === 'student') {
                            loadStudentScores(userId);
                        } else if (targetId === 'course-selection' && userRole === 'student') {
                            loadAvailableCourses();
                        }
                    }
                });
            });
        }

        // ========== 显示/隐藏内容区域的函数 ==========
        
        function showAdminSections() {
            // 隐藏所有区域
            document.querySelectorAll('.content-section').forEach(s => {
                s.style.display = 'none';
                s.classList.remove('active');
            });
            // 显示管理员区域（所有区域都可用，但只有第一个激活）
            const sections = ['user-management', 'student-management', 'teacher-management', 'course-management', 'statistics'];
            sections.forEach((id, index) => {
                const section = document.getElementById(id);
                if (section) {
                    section.style.display = 'block';
                    if (index === 0) {
                        section.classList.add('active');
                    }
                }
            });
            // 加载数据
            loadUsers();
            loadStudents();
            loadTeachers();
            loadCourses();
        }

        function showTeacherSections() {
            // 隐藏所有区域
            document.querySelectorAll('.content-section').forEach(s => {
                s.style.display = 'none';
                s.classList.remove('active');
            });
            // 创建教师区域（如果不存在）
            const teacherScoreSection = document.getElementById('teacher-score-management');
            if (!teacherScoreSection) {
                createTeacherSections();
            }
            // 显示教师区域（所有区域都可用，但只有第一个激活）
            const sections = ['teacher-score-management', 'teacher-statistics', 'teacher-courses'];
            sections.forEach((id, index) => {
                const section = document.getElementById(id);
                if (section) {
                    section.style.display = 'block';
                    if (index === 0) {
                        section.classList.add('active');
                    }
                }
            });
        }

        function showStudentSections() {
            // 隐藏所有区域
            document.querySelectorAll('.content-section').forEach(s => {
                s.style.display = 'none';
                s.classList.remove('active');
            });
            // 创建学生区域（如果不存在）
            const studentInfoSection = document.getElementById('student-info');
            if (!studentInfoSection) {
                createStudentSections();
            }
            // 显示学生区域（所有区域都可用，但只有第一个激活）
            const sections = ['student-info', 'student-courses', 'student-scores', 'course-selection'];
            sections.forEach((id, index) => {
                const section = document.getElementById(id);
                if (section) {
                    section.style.display = 'block';
                    if (index === 0) {
                        section.classList.add('active');
                    }
                }
            });
        }

        // 创建教师内容区域
        function createTeacherSections() {
            const container = document.querySelector('.container');
            
            // 教师成绩管理
            const teacherScoreSection = document.createElement('section');
            teacherScoreSection.id = 'teacher-score-management';
            teacherScoreSection.className = 'content-section';
            teacherScoreSection.innerHTML = `
                <h2 class="section-title">
                    <span>成绩管理</span>
                </h2>
                <div class="search-bar">
                    <select id="teacherCourseSelect">
                        <option value="">选择课程</option>
                    </select>
                    <button class="btn btn-primary" onclick="loadTeacherCourseStudents()">查看学生名单</button>
                    <button class="btn btn-success" onclick="showBatchImportModal()">批量导入</button>
                    <button class="btn btn-warning" onclick="exportScores()">导出成绩</button>
                </div>
                <table id="teacherScoreTable">
                    <thead>
                        <tr>
                            <th>学生ID</th>
                            <th>课程ID</th>
                            <th>成绩</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="teacherScoreTableBody"></tbody>
                </table>
            `;
            container.appendChild(teacherScoreSection);

            // 教师成绩统计
            const teacherStatsSection = document.createElement('section');
            teacherStatsSection.id = 'teacher-statistics';
            teacherStatsSection.className = 'content-section';
            teacherStatsSection.innerHTML = `
                <h2 class="section-title">
                    <span>成绩统计</span>
                </h2>
                <div class="search-bar">
                    <select id="teacherStatCourseSelect">
                        <option value="">选择课程</option>
                    </select>
                    <button class="btn btn-primary" onclick="loadTeacherStatistics()">查询统计</button>
                </div>
                <div id="teacherStatisticsResult"></div>
            `;
            container.appendChild(teacherStatsSection);

            // 我的课程
            const teacherCoursesSection = document.createElement('section');
            teacherCoursesSection.id = 'teacher-courses';
            teacherCoursesSection.className = 'content-section';
            teacherCoursesSection.innerHTML = `
                <h2 class="section-title">
                    <span>我的课程</span>
                </h2>
                <table id="teacherCoursesTable">
                    <thead>
                        <tr>
                            <th>课程ID</th>
                            <th>课程名称</th>
                            <th>学分</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="teacherCoursesTableBody"></tbody>
                </table>
            `;
            container.appendChild(teacherCoursesSection);
        }

        // 创建学生内容区域
        function createStudentSections() {
            const container = document.querySelector('.container');
            
            // 个人信息
            const studentInfoSection = document.createElement('section');
            studentInfoSection.id = 'student-info';
            studentInfoSection.className = 'content-section';
            studentInfoSection.innerHTML = `
                <h2 class="section-title">
                    <span>个人信息</span>
                    <button class="btn btn-primary" onclick="showUpdatePasswordModal()">修改密码</button>
                </h2>
                <div id="studentInfoContent"></div>
            `;
            container.appendChild(studentInfoSection);

            // 我的选课
            const studentCoursesSection = document.createElement('section');
            studentCoursesSection.id = 'student-courses';
            studentCoursesSection.className = 'content-section';
            studentCoursesSection.innerHTML = `
                <h2 class="section-title">
                    <span>我的选课</span>
                </h2>
                <table id="studentCoursesTable">
                    <thead>
                        <tr>
                            <th>课程ID</th>
                            <th>课程名称</th>
                            <th>学分</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="studentCoursesTableBody"></tbody>
                </table>
            `;
            container.appendChild(studentCoursesSection);

            // 我的成绩
            const studentScoresSection = document.createElement('section');
            studentScoresSection.id = 'student-scores';
            studentScoresSection.className = 'content-section';
            studentScoresSection.innerHTML = `
                <h2 class="section-title">
                    <span>我的成绩</span>
                </h2>
                <div id="studentScoresContent"></div>
                <table id="studentScoresTable">
                    <thead>
                        <tr>
                            <th>课程ID</th>
                            <th>课程名称</th>
                            <th>成绩</th>
                        </tr>
                    </thead>
                    <tbody id="studentScoresTableBody"></tbody>
                </table>
                <div id="studentStatisticsInfo" style="margin-top: 20px;"></div>
            `;
            container.appendChild(studentScoresSection);

            // 选课中心
            const courseSelectionSection = document.createElement('section');
            courseSelectionSection.id = 'course-selection';
            courseSelectionSection.className = 'content-section';
            courseSelectionSection.innerHTML = `
                <h2 class="section-title">
                    <span>选课中心</span>
                </h2>
                <div class="search-bar">
                    <button class="btn btn-primary" onclick="loadAvailableCourses()">刷新课程列表</button>
                </div>
                <table id="availableCoursesTable">
                    <thead>
                        <tr>
                            <th>课程ID</th>
                            <th>课程名称</th>
                            <th>学分</th>
                            <th>教师ID</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="availableCoursesTableBody"></tbody>
                </table>
            `;
            container.appendChild(courseSelectionSection);
        }

        // ========== 教师相关函数 ==========
        
        async function loadTeacherCourses(userId) {
            try {
                const response = await fetch(`${API_BASE}/courseManagement/getAllCourse`);
                const courses = await response.json();
                // 筛选该教师的课程
                const teacherCourses = courses.filter(c => c.teacherId == userId || c.userId == userId);
                
                // 更新课程选择下拉框
                const courseSelect = document.getElementById('teacherCourseSelect');
                const statCourseSelect = document.getElementById('teacherStatCourseSelect');
                if (courseSelect) {
                    courseSelect.innerHTML = '<option value="">选择课程</option>' + 
                        teacherCourses.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
                }
                if (statCourseSelect) {
                    statCourseSelect.innerHTML = '<option value="">选择课程</option>' + 
                        teacherCourses.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
                }
                
                // 显示我的课程
                const tbody = document.getElementById('teacherCoursesTableBody');
                if (tbody) {
                    tbody.innerHTML = teacherCourses.map(c => `
                        <tr>
                            <td>${c.id}</td>
                            <td>${c.name || ''}</td>
                            <td>${c.credit || ''}</td>
                            <td>
                                <button class="btn btn-primary" onclick="loadTeacherCourseStudentsByCourse(${c.id})">管理成绩</button>
                            </td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                showMessage('加载课程失败: ' + error.message, 'error');
            }
        }

        async function loadTeacherCourseStudents() {
            const courseId = document.getElementById('teacherCourseSelect').value;
            if (!courseId) {
                showMessage('请先选择课程', 'error');
                return;
            }
            loadTeacherCourseStudentsByCourse(courseId);
        }

        async function loadTeacherCourseStudentsByCourse(courseId) {
            try {
                const response = await fetch(`${API_BASE}/courseSelect/getCourseStudents/${courseId}`);
                const selections = await response.json();
                const tbody = document.getElementById('teacherScoreTableBody');
                if (tbody) {
                    tbody.innerHTML = selections.map(s => `
                        <tr>
                            <td>${s.studentId}</td>
                            <td>${s.courseId}</td>
                            <td>${s.score >= 0 ? s.score : '未录入'}</td>
                            <td>
                                <input type="number" id="teacher_score_${s.studentId}_${s.courseId}" value="${s.score >= 0 ? s.score : ''}" min="0" max="100" style="width:80px;">
                                <button class="btn btn-primary" onclick="updateScore(${s.studentId}, ${s.courseId}, 'teacher')">保存</button>
                            </td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                showMessage('加载学生名单失败: ' + error.message, 'error');
            }
        }

        async function loadTeacherStatistics() {
            const courseId = document.getElementById('teacherStatCourseSelect').value;
            if (!courseId) {
                showMessage('请先选择课程', 'error');
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/statisticsMessage/courseStatistics?courseId=${courseId}`);
                const stats = await response.json();
                const resultDiv = document.getElementById('teacherStatisticsResult');
                if (resultDiv) {
                    resultDiv.innerHTML = `
                        <h3>课程统计信息</h3>
                        <p>平均分: ${stats.average !== null ? stats.average.toFixed(2) : '无'}</p>
                        <p>最高分: ${stats.max !== null ? stats.max : '无'}</p>
                        <p>最低分: ${stats.min !== null ? stats.min : '无'}</p>
                        <p>总人数: ${stats.count}</p>
                    `;
                }
            } catch (error) {
                showMessage('加载统计失败: ' + error.message, 'error');
            }
        }

        function exportScores() {
            alert('导出功能开发中...');
        }

        // ========== 学生相关函数 ==========
        
        async function loadStudentInfo(userId) {
            const username = sessionStorage.getItem('username');
            const contentDiv = document.getElementById('studentInfoContent');
            if (contentDiv) {
                // 显示用户基本信息
                contentDiv.innerHTML = `
                    <p><strong>用户名:</strong> ${username || '未设置'}</p>
                    <p><strong>用户ID:</strong> ${userId}</p>
                    <p><strong>角色:</strong> 学生</p>
                    <p style="color: #7f8c8d; margin-top: 10px;">提示：如需完善学号等信息，请联系管理员</p>
                `;
                
                // 尝试查找对应的学生记录（通过学生ID等于用户ID）
                try {
                    const response = await fetch(`${API_BASE}/student/getById/${userId}`);
                    const student = await response.json();
                    if (student && student.id) {
                        contentDiv.innerHTML = `
                            <p><strong>学号:</strong> ${student.studentNumber || '未设置'}</p>
                            <p><strong>姓名:</strong> ${student.name || '未设置'}</p>
                            <p><strong>用户ID:</strong> ${userId}</p>
                            <p><strong>用户名:</strong> ${username || '未设置'}</p>
                        `;
                    }
                } catch (error) {
                    // 如果找不到学生记录，使用上面的默认显示
                }
            }
        }

        async function loadStudentCourses(studentId) {
            try {
                const response = await fetch(`${API_BASE}/courseSelect/getStudentCourses/${studentId}`);
                const selections = await response.json();
                const tbody = document.getElementById('studentCoursesTableBody');
                if (tbody) {
                    // 获取课程详情
                    const coursesResponse = await fetch(`${API_BASE}/courseManagement/getAllCourse`);
                    const courses = await coursesResponse.json();
                    const courseMap = {};
                    courses.forEach(c => courseMap[c.id] = c);
                    
                    tbody.innerHTML = selections.map(s => {
                        const course = courseMap[s.courseId];
                        return `
                            <tr>
                                <td>${s.courseId}</td>
                                <td>${course ? course.name : '未知课程'}</td>
                                <td>${course ? course.credit : ''}</td>
                                <td>
                                    <button class="btn btn-danger" onclick="dropCourse(${s.studentId}, ${s.courseId})">退选</button>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
            } catch (error) {
                showMessage('加载选课列表失败: ' + error.message, 'error');
            }
        }

        async function loadStudentScores(studentId) {
            try {
                const response = await fetch(`${API_BASE}/courseSelect/getStudentCourses/${studentId}`);
                const selections = await response.json();
                const tbody = document.getElementById('studentScoresTableBody');
                if (tbody) {
                    // 获取课程详情
                    const coursesResponse = await fetch(`${API_BASE}/courseManagement/getAllCourse`);
                    const courses = await coursesResponse.json();
                    const courseMap = {};
                    courses.forEach(c => courseMap[c.id] = c);
                    
                    tbody.innerHTML = selections.map(s => {
                        const course = courseMap[s.courseId];
                        return `
                            <tr>
                                <td>${s.courseId}</td>
                                <td>${course ? course.name : '未知课程'}</td>
                                <td>${s.score >= 0 ? s.score : '未录入'}</td>
                            </tr>
                        `;
                    }).join('');
                }
                
                // 加载统计信息
                const statsResponse = await fetch(`${API_BASE}/statisticsMessage/studentStatistics?studentId=${studentId}`);
                const stats = await statsResponse.json();
                const statsDiv = document.getElementById('studentStatisticsInfo');
                if (statsDiv) {
                    statsDiv.innerHTML = `
                        <h3>成绩统计</h3>
                        <p>平均分: ${stats.average !== null ? stats.average.toFixed(2) : '无'}</p>
                        <p>最高分: ${stats.max !== null ? stats.max : '无'}</p>
                        <p>最低分: ${stats.min !== null ? stats.min : '无'}</p>
                        <p>课程数: ${stats.count}</p>
                    `;
                }
            } catch (error) {
                showMessage('加载成绩失败: ' + error.message, 'error');
            }
        }

        async function loadAvailableCourses() {
            try {
                const response = await fetch(`${API_BASE}/courseManagement/getAllCourse`);
                const courses = await response.json();
                const tbody = document.getElementById('availableCoursesTableBody');
                if (tbody) {
                    const studentId = sessionStorage.getItem('userId');
                    // 获取已选课程
                    const selectionsResponse = await fetch(`${API_BASE}/courseSelect/getStudentCourses/${studentId}`);
                    const selections = await selectionsResponse.json();
                    const selectedCourseIds = new Set(selections.map(s => s.courseId));
                    
                    tbody.innerHTML = courses.map(c => {
                        const isSelected = selectedCourseIds.has(c.id);
                        return `
                            <tr>
                                <td>${c.id}</td>
                                <td>${c.name || ''}</td>
                                <td>${c.credit || ''}</td>
                                <td>${c.teacherId || ''}</td>
                                <td>
                                    ${isSelected ? 
                                        '<span style="color: green;">已选</span>' : 
                                        `<button class="btn btn-success" onclick="selectCourse(${studentId}, ${c.id})">选课</button>`
                                    }
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
            } catch (error) {
                showMessage('加载课程列表失败: ' + error.message, 'error');
            }
        }

        async function selectCourse(studentId, courseId) {
            try {
                const response = await fetch(`${API_BASE}/courseSelect/selectOneCourse?studentId=${studentId}&courseId=${courseId}`, {
                    method: 'PUT'
                });
                const result = await response.text();
                showMessage(result);
                loadAvailableCourses();
                loadStudentCourses(studentId);
            } catch (error) {
                showMessage('选课失败: ' + error.message, 'error');
            }
        }

        async function dropCourse(studentId, courseId) {
            if (!confirm('确定要退选这门课程吗？')) return;
            try {
                const response = await fetch(`${API_BASE}/courseSelect/deleteCourseSelection/${studentId}/${courseId}`, {
                    method: 'DELETE'
                });
                const result = await response.text();
                showMessage(result);
                loadStudentCourses(studentId);
                loadAvailableCourses();
            } catch (error) {
                showMessage('退选失败: ' + error.message, 'error');
            }
        }

        function showUpdatePasswordModal() {
            const oldPassword = prompt('请输入原密码:');
            if (!oldPassword) return;
            const newPassword = prompt('请输入新密码:');
            if (!newPassword) return;
            const confirmPassword = prompt('请再次输入新密码:');
            if (newPassword !== confirmPassword) {
                alert('两次输入的密码不一致');
                return;
            }
            updatePassword(oldPassword, newPassword);
        }

        async function updatePassword(oldPassword, newPassword) {
            const username = sessionStorage.getItem('username');
            try {
                const response = await fetch(`${API_BASE}/user/updatePassword?username=${encodeURIComponent(username)}&oldPassword=${encodeURIComponent(oldPassword)}&newPassword=${encodeURIComponent(newPassword)}`, {
                    method: 'PUT'
                });
                const result = await response.text();
                alert(result);
            } catch (error) {
                alert('修改密码失败: ' + error.message);
            }
        }

        // ========== 用户管理函数 ==========
        
        async function loadUsers() {
            try {
                // 注意：需要添加获取所有用户的接口
                showMessage('用户列表功能需要后端支持', 'error');
            } catch (error) {
                showMessage('加载用户列表失败: ' + error.message, 'error');
            }
        }

        async function searchUsers() {
            const username = document.getElementById('userSearch').value;
            if (!username) {
                loadUsers();
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/user/getByUsername?username=${encodeURIComponent(username)}`);
                const user = await response.json();
                const tbody = document.getElementById('userTableBody');
                if (user) {
                    tbody.innerHTML = `
                        <tr>
                            <td>${user.id}</td>
                            <td>${user.username}</td>
                            <td>${user.role || ''}</td>
                            <td>
                                <button class="btn btn-danger" onclick="deleteUserByUsername('${user.username}')">删除</button>
                            </td>
                        </tr>
                    `;
                } else {
                    tbody.innerHTML = '<tr><td colspan="4">未找到用户</td></tr>';
                }
            } catch (error) {
                showMessage('搜索失败: ' + error.message, 'error');
            }
        }

        async function deleteUserByUsername(username) {
            if (!confirm('确定要删除这个用户吗？')) return;
            try {
                const response = await fetch(`${API_BASE}/user/delete/${encodeURIComponent(username)}`, {method: 'DELETE'});
                const result = await response.text();
                showMessage(result);
                loadUsers();
            } catch (error) {
                showMessage('删除失败: ' + error.message, 'error');
            }
        }

        // 修改updateScore函数以支持教师界面
        async function updateScore(studentId, courseId, source = 'admin') {
            const scoreInput = document.getElementById(`score_${studentId}_${courseId}`) || 
                              document.getElementById(`teacher_score_${studentId}_${courseId}`);
            if (!scoreInput) return;
            
            const score = parseInt(scoreInput.value);
            if (isNaN(score) || score < 0 || score > 100) {
                showMessage('成绩必须在0-100之间', 'error');
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/scoreManagement/addScore?StudentId=${studentId}&CourseId=${courseId}&score=${score}`, {
                    method: 'POST'
                });
                const result = await response.text();
                showMessage(result);
                if (source === 'teacher') {
                    loadTeacherCourseStudents();
                } else {
                    loadCourseStudents();
                }
            } catch (error) {
                showMessage('更新失败: ' + error.message, 'error');
            }
        }

        // 退出登录
        function logout() {
            if (confirm('确定要退出吗？')) {
                // 清除登录状态
                sessionStorage.removeItem('isLoggedIn');
                sessionStorage.removeItem('username');
                sessionStorage.removeItem('userId');
                sessionStorage.removeItem('userRole');
                sessionStorage.removeItem('loginTime');
                // 跳转到登录页面
                window.location.href = '登陆界面.html';
            }
        }

        // 页面加载时初始化
        window.addEventListener('DOMContentLoaded', function() {
            // 先检查登录状态
            checkLoginStatus();
        });
    </script>
</body>
</html>

